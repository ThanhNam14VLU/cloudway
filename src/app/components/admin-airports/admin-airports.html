<main class="main-content">
  <header class="page-header">
    <h1>Quản lý Sân bay</h1>
    <div class="header-actions">
      <button class="add-new-btn" (click)="toggleAddForm()">
        <i class="fa-solid fa-plus"></i> Thêm Sân Bay
      </button>
      <button class="refresh-btn" (click)="loadAirports()">
        <i class="fa-solid fa-refresh"></i> Làm mới
      </button>
    </div>
  </header>

  <div class="content-container">
    <!-- Add Airport Dialog -->
    <div *ngIf="showAddForm" class="dialog-overlay" (click)="toggleAddForm()">
      <div class="dialog-container" (click)="$event.stopPropagation()">
        <div class="dialog-header">
          <h3>Thêm Sân Bay Mới</h3>
          <button class="close-btn" (click)="toggleAddForm()">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
        
        <form #airportForm="ngForm" (ngSubmit)="onSubmit(airportForm)" class="dialog-form">
          <div class="form-row">
            <div class="form-group">
              <label for="iata_code">Mã IATA *</label>
              <input 
                type="text" 
                id="iata_code"
                name="iata_code"
                [(ngModel)]="newAirport.iata_code"
                #iataCode="ngModel"
                required
                maxlength="3"
                minlength="3"
                placeholder="VD: SGN"
                class="form-control"
                [class.error]="iataCode.invalid && iataCode.touched">
              <div *ngIf="iataCode.invalid && iataCode.touched" class="error-message">
                Mã IATA phải có đúng 3 ký tự
              </div>
            </div>
            
            <div class="form-group">
              <label for="name">Tên Sân Bay *</label>
              <input 
                type="text" 
                id="name"
                name="name"
                [(ngModel)]="newAirport.name"
                #name="ngModel"
                required
                maxlength="255"
                placeholder="VD: Tan Son Nhat International Airport"
                class="form-control"
                [class.error]="name.invalid && name.touched">
              <div *ngIf="name.invalid && name.touched" class="error-message">
                Tên sân bay là bắt buộc
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="city">Thành Phố *</label>
              <input 
                type="text" 
                id="city"
                name="city"
                [(ngModel)]="newAirport.city"
                #city="ngModel"
                required
                maxlength="100"
                placeholder="VD: Ho Chi Minh City"
                class="form-control"
                [class.error]="city.invalid && city.touched">
              <div *ngIf="city.invalid && city.touched" class="error-message">
                Thành phố là bắt buộc
              </div>
            </div>
            
            <div class="form-group">
              <label for="country">Quốc Gia</label>
              <input 
                type="text" 
                id="country"
                name="country"
                [(ngModel)]="newAirport.country"
                readonly
                class="form-control readonly-field">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group full-width">
              <label for="timezone">Múi Giờ</label>
              <input 
                type="text" 
                id="timezone"
                name="timezone"
                [(ngModel)]="newAirport.timezone"
                readonly
                class="form-control readonly-field">
            </div>
          </div>
          
          <div class="dialog-actions">
            <button type="button" class="btn btn-secondary" (click)="toggleAddForm()">
              Hủy
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="airportForm.invalid || submitting">
              <i *ngIf="submitting" class="fa-solid fa-spinner fa-spin"></i>
              <i *ngIf="!submitting" class="fa-solid fa-plus"></i>
              {{ submitting ? 'Đang thêm...' : 'Thêm Sân Bay' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="table-toolbar">
      <div class="search-container">
        <i class="fa-solid fa-search"></i>
        <input 
          type="text" 
          placeholder="Tìm kiếm theo tên sân bay, mã IATA, thành phố..." 
          [(ngModel)]="searchTerm">
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="loading" class="loading-container">
      <i class="fa-solid fa-spinner fa-spin"></i>
      <span>Đang tải dữ liệu...</span>
    </div>

    <div class="table-responsive" *ngIf="!loading">
      <table>
        <thead>
        <tr>
          <th>Mã IATA</th>
          <th>Tên Sân Bay</th>
          <th>Thành Phố</th>
          <th>Quốc Gia</th>
          <th>Múi Giờ</th>
          <th>Ngày Tạo</th>
          <th>Thao tác</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let airport of filteredAirports; let i = index">
          <td>{{ airport.iata_code || '-' }}</td>
          <td>{{ airport.name || '-' }}</td>
          <td>{{ airport.city || '-' }}</td>
          <td>{{ airport.country || '-' }}</td>
          <td>{{ airport.timezone || '-' }}</td>
          <td>{{ formatDate(airport.created_at) }}</td>
          <td class="actions-cell">
            <button 
              class="delete-btn" 
              (click)="onDeleteAirport(airport)"
              title="Xóa sân bay">
              <i class="fa-solid fa-trash"></i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
      
      <!-- Empty state -->
      <div *ngIf="filteredAirports.length === 0 && !loading" class="empty-state">
        <i class="fa-solid fa-plane"></i>
        <p>Không tìm thấy sân bay nào</p>
      </div>
    </div>
  </div>

  <!-- Success Notification Dialog -->
  <app-notification-dialog
    [visible]="showSuccessDialog"
    type="success"
    title="Thành công"
    [message]="successMessage"
    confirmText="Đóng"
    (confirm)="onSuccessDialogClose()"
    (close)="onSuccessDialogClose()">
  </app-notification-dialog>

  <!-- Delete Confirmation Dialog -->
  <app-confirm-dialog
    [visible]="showDeleteDialog"
    title="Xác nhận xóa"
    [message]="getDeleteMessage()"
    confirmText="Xóa"
    cancelText="Hủy"
    iconClass="fa-exclamation-triangle"
    confirmButtonClass="btn-danger"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()">
  </app-confirm-dialog>
</main>
