<app-header></app-header>

<!-- Booking Information Section -->
<div class="booking-container">
  <!-- Header -->
  <!-- <div class="booking-header">
    <h1>Thông tin đặt chỗ</h1>
    <p>Hoàn tất thông tin để đặt vé</p>
  </div> -->

  <!-- Progress Steps -->
  <div class="progress-steps">
    <div [ngClass]="getStepClass(1)">
      <div class="step-circle">
        1
      </div>
      <span>Thông tin hành khách</span>
    </div>
    <div class="step-line" [ngClass]="isStepCompleted(1) ? 'completed' : ''"></div>
    <div [ngClass]="getStepClass(2)">
      <div class="step-circle">2</div>
      <span>Liên hệ & Yêu cầu</span>
    </div>
    <div class="step-line" [ngClass]="isStepCompleted(2) ? 'completed' : ''"></div>
    <div [ngClass]="getStepClass(3)">
      <div class="step-circle">3</div>
      <span>Thanh toán</span>
    </div>
  </div>

  <!-- Main Content -->
  <div class="booking-content">
    <!-- Left Column - Dynamic Content based on current step -->
    <div class="passenger-info">
      
      <!-- Step 1: Passenger Information -->
      @if (currentStep === 1) {
        <div class="section-header">
          <!-- <i class="fas fa-user"></i> -->
          <h2>Thông tin hành khách</h2>
        </div>

        <!-- Passenger 1 Card -->
        <div class="passenger-card">
          <h3>Hành khách 1</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Danh xưng *</label>
              <select [(ngModel)]="passengerInfo.title">
                <option value="">Chọn</option>
                <option value="mr">Ông</option>
                <option value="ms">Bà</option>
                <option value="miss">Cô</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Họ và tên đệm *</label>
              <input type="text" placeholder="Nhập họ và tên đệm" [(ngModel)]="passengerInfo.firstName">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Tên *</label>
              <input type="text" placeholder="Nhập tên" [(ngModel)]="passengerInfo.lastName">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Ngày sinh *</label>
              <input type="date" [(ngModel)]="passengerInfo.birthDate">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>CMND/CCCD *</label>
              <input type="text" placeholder="Nhập số CMND/CCCD" [(ngModel)]="passengerInfo.idNumber">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Số điện thoại</label>
              <input type="tel" placeholder="Nhập số điện thoại" [(ngModel)]="passengerInfo.phone">
            </div>
          </div>

          <!-- Information Alert -->
          <div class="info-alert">
            <div class="alert-icon">
              <!-- <i class="fas fa-info-circle"></i> -->
            </div>
            <p>Vui lòng nhập thông tin chính xác theo giấy tờ tùy thân. Thông tin sai có thể dẫn đến từ chối check-in.</p>
          </div>
        </div>
      }

      <!-- Step 2: Contact Information -->
      @if (currentStep === 2) {
        <div class="section-header">
          <!-- <i class="fas fa-phone"></i> -->
          <h2>Thông tin liên hệ & Yêu cầu đặc biệt</h2>
        </div>

        <!-- Contact Information -->
        <div class="contact-card">
          <h3>Thông tin liên hệ</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label>Danh xưng *</label>
              <select [(ngModel)]="contactInfo.title">
                <option value="">Chọn</option>
                <option value="mr">Ông</option>
                <option value="ms">Bà</option>
                <option value="miss">Cô</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Họ và tên *</label>
              <input type="text" placeholder="Nhập họ và tên đầy đủ" [(ngModel)]="contactInfo.fullName">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Số điện thoại *</label>
              <input type="tel" placeholder="Nhập số điện thoại" [(ngModel)]="contactInfo.phone">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Email *</label>
              <input type="email" placeholder="Nhập email" [(ngModel)]="contactInfo.email">
            </div>
          </div>
        </div>

        <!-- Special Requests -->
        <div class="special-requests-card">
          <h3>Yêu cầu đặc biệt (tuỳ chọn)</h3>
          <div class="form-group">
            <textarea 
              placeholder="Suất ăn chay, hỗ trợ xe lăn, ghế gần lối đi..." 
              [(ngModel)]="specialRequests"
              rows="4"></textarea>
          </div>
        </div>

        <!-- Additional Services -->
        <div class="additional-services-card">
          <h3>Dịch vụ bổ sung</h3>
          
          <div class="service-item">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="additionalServices.specialMeal">
              <span class="checkmark"></span>
              <span class="service-text">Suất ăn đặc biệt (+150.000 VND)</span>
            </label>
          </div>

          <div class="service-item">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="additionalServices.extraLuggage">
              <span class="checkmark"></span>
              <span class="service-text">Hành lý thêm 15kg (+300.000 VND)</span>
            </label>
          </div>

          <div class="service-item">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="additionalServices.seatSelection">
              <span class="checkmark"></span>
              <span class="service-text">Chọn ghế ngồi (+200.000 VND)</span>
            </label>
          </div>
        </div>
      }

      <!-- Step 3: Payment -->
      @if (currentStep === 3) {
        <div class="section-header">
          <!-- <i class="fas fa-credit-card"></i> -->
          <h2>Thanh toán</h2>
        </div>

        <!-- Booking Overview -->
        <div class="overview-card">
          <h3>Tổng hợp đặt vé</h3>
          
          <!-- Passenger Info -->
          <div class="overview-section">
            <h4>Thông tin hành khách</h4>
            <div class="overview-item">
              <span class="label">Hành khách:</span>
              <span class="value">{{ getPassengerDisplayName() }}</span>
            </div>
            <div class="overview-item">
              <span class="label">Ngày sinh:</span>
              <span class="value">{{ passengerInfo.birthDate | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="overview-item">
              <span class="label">CMND/CCCD:</span>
              <span class="value">{{ passengerInfo.idNumber }}</span>
            </div>
          </div>

          <!-- Contact Info -->
          <div class="overview-section">
            <h4>Thông tin liên hệ</h4>
            <div class="overview-item">
              <span class="label">Người liên hệ:</span>
              <span class="value">{{ getContactDisplayName() }}</span>
            </div>
            <div class="overview-item">
              <span class="label">Số điện thoại:</span>
              <span class="value">{{ contactInfo.phone }}</span>
            </div>
            <div class="overview-item">
              <span class="label">Email:</span>
              <span class="value">{{ contactInfo.email }}</span>
            </div>
          </div>

          <!-- Flight Info -->
          <div class="overview-section">
            <h4>Thông tin chuyến bay</h4>
            <div class="overview-item">
              <span class="label">Hãng hàng không:</span>
              <span class="value">Bamboo Airways - QH818</span>
            </div>
            <div class="overview-item">
              <span class="label">Tuyến bay:</span>
              <span class="value">Hải Phòng → Phú Quốc</span>
            </div>
            <div class="overview-item">
              <span class="label">Ngày bay:</span>
              <span class="value">Thứ Sáu, 22 tháng 2, 2025</span>
            </div>
            <div class="overview-item">
              <span class="label">Thời gian:</span>
              <span class="value">11:00 - 13:15</span>
            </div>
          </div>

          <!-- Special Requests -->
          @if (specialRequests) {
            <div class="overview-section">
              <h4>Yêu cầu đặc biệt</h4>
              <div class="overview-item">
                <span class="value">{{ specialRequests }}</span>
              </div>
            </div>
          }

          <!-- Additional Services -->
          @if (hasAdditionalServices()) {
            <div class="overview-section">
              <h4>Dịch vụ bổ sung</h4>
              @if (additionalServices.specialMeal) {
                <div class="overview-item">
                  <span class="value">Suất ăn đặc biệt (+150.000 VND)</span>
                </div>
              }
              @if (additionalServices.extraLuggage) {
                <div class="overview-item">
                  <span class="value">Hành lý thêm 15kg (+300.000 VND)</span>
                </div>
              }
              @if (additionalServices.seatSelection) {
                <div class="overview-item">
                  <span class="value">Chọn ghế ngồi (+200.000 VND)</span>
                </div>
              }
            </div>
          }
        </div>

        <!-- Payment Method -->
        <div class="payment-card">
          <h3>Phương thức thanh toán</h3>
          
          <div class="payment-method">
            <div class="momo-payment">
              <div class="momo-header">
                <div class="momo-logo">
                  <img width="40px" height="40px" src="./assets/images/momo.webp" alt="MoMo Logo">
                </div>
                <div class="momo-info">
                  <h4>MoMo</h4>
                  <p>Quét mã QR để thanh toán</p>
                </div>
              </div>
              
              <div class="payment-amount">
                <div class="amount-detail">
                  <span class="label">Tổng thanh toán: 716.100 VND</span>
                  <span class="amount">{{ getTotalAmount() | currency:'VND':'symbol':'1.0-0':'vi' }}</span>
                </div>
              </div>
              
              <div class="qr-section">
                <div class="qr-code">
                  <img width="100px" height="100px" src="./assets/images/momo_qr.jpg" alt="MoMo QR Code" class="qr-image">
                  <p class="qr-instruction">Quét mã QR bằng ứng dụng MoMo để thanh toán</p>
                </div>
              </div>
              
              <div class="payment-info">
                <div class="info-item">
                  <!-- <i class="fas fa-shield-alt"></i> -->
                  <span>Thanh toán an toàn và bảo mật</span>
                </div>
                <div class="info-item">
                  <!-- <i class="fas fa-clock"></i> -->
                  <span>Xử lý trong 1-2 phút</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Right Column - Flight Details -->
    <div class="flight-summary">
      <h2>Chi tiết chuyến bay</h2>
      
      <div class="airline-info">
        <div class="airline-logo">
          <img width="40px" height="40px" src="./assets/images/Bamboo.png" alt="">
        </div>
        <div class="airline-details">
          <h3>Bamboo Airways</h3>
          <p>QH818</p>
        </div>
      </div>

      <div class="flight-details">
        <div class="detail-item">
          <span class="label">Ngày bay:</span>
          <span class="value">Thứ Sáu, 22 tháng 2, 2025</span>
        </div>
        <div class="detail-item">
          <span class="label">Tuyến bay:</span>
          <span class="value">Hải Phòng → Phú Quốc</span>
        </div>
        <div class="detail-item">
          <span class="label">Thời gian:</span>
          <span class="value">11:00 - 13:15</span>
        </div>
        <div class="detail-item">
          <span class="label">Hành khách:</span>
          <span class="value">1 người</span>
        </div>
      </div>

      <div class="price-breakdown">
        <div class="price-item">
          <span>Giá vé (1 x 651.000 ₫):</span>
          <span>651.000 ₫</span>
        </div>
        <div class="price-item">
          <span>Thuế và phí:</span>
          <span>65.100 ₫</span>
        </div>
        <div class="price-item total">
          <span>Tổng cộng:</span>
          <span>716.100 ₫</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Navigation -->
  <div class="booking-footer">
    <button class="btn-secondary" (click)="previousStep()">Quay lại</button>
    @if (currentStep < 3) {
      <button class="btn-primary" (click)="nextStep()">Tiếp tục</button>
    } @else {
      <button class="btn-primary" (click)="completeBooking()">Hoàn tất đặt chỗ</button>
    }
  </div>
</div>
